<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- 
	Mapping file autogenerated by MyEclipse Persistence Tools
-->
<hibernate-mapping>
	<class name="bbr.b2b.walmart.logistic.buyorders.entities.OrderReception" table="ORDERRECEPTION" 
		entity-name="bbr.b2b.walmart.logistic.buyorders.entities.OrderReception" schema="LOGISTICA">
		<composite-id name="id" class="bbr.b2b.walmart.logistic.buyorders.entities.OrderReceptionId">
			<key-property name="orderid" access="field" column="ORDER_ID" />
			<key-property name="receptionid" access="field" column="RECEPTION_ID" />
		</composite-id>		
		
		<property name="currentsoastatetypedate" type="timestamp" column="CURRENTSOASTATETYPEDATE" />	
		
		<many-to-one name="order" column="ORDER_ID" not-null="true" insert="false" update="false" />
		<many-to-one name="reception" column="RECEPTION_ID" not-null="true" insert="false" update="false" />
		<many-to-one name="currentsoastatetype"
			class="bbr.b2b.walmart.logistic.soa.entities.SOAStateType" column="CURRENTSOASTATETYPE_ID"
			not-null="false" />	
			
			
		<sql-query name="getOrderReceptionsToSendSoa">
			<![CDATA[
				SELECT 
					ODR.ORDER_ID AS ORDERID,
					ODR.RECEPTION_ID AS RECEPTIONID
				FROM LOGISTICA.ORDERRECEPTION AS ODR
				JOIN LOGISTICA.ORDER AS O ON ODR.ORDER_ID = O.ID
				JOIN LOGISTICA.RECEPTION AS R ON ODR.RECEPTION_ID = R.ID
				WHERE O.BUYER_ID = :buyerid AND 
					O.VENDOR_ID = :vendorid AND 
					ODR.CURRENTSOASTATETYPE_ID = :notifstid AND 
					R.SYNCDATE >= :since
				ORDER BY ORDERID
				]]>
		</sql-query>
			
		<sql-query name="getPendingSOAReceptionsByVendor">
			<![CDATA[
				SELECT
					COUNT(RE.ID)
				FROM
					LOGISTICA.ORDERRECEPTION AS OCR JOIN
					LOGISTICA.ORDER AS OC ON OCR.ORDER_ID = OC.ID JOIN
					LOGISTICA.RECEPTION AS RE ON OCR.RECEPTION_ID = RE.ID JOIN
					LOGISTICA.VENDOR AS VD ON VD.ID = OC.VENDOR_ID JOIN
					LOGISTICA.BUYER AS BY ON BY.ID = OC.BUYER_ID JOIN
					LOGISTICA.SOASTATETYPE AS SST ON SST.ID = OCR.CURRENTSOASTATETYPE_ID 

				WHERE 
					SST.ID <> :soastatetype AND
					OCR.CURRENTSOASTATETYPEDATE <= :soapendingtime AND
					VD.ID = :vendorid AND
					BY.ID = :buyerid AND
					RE.SYNCDATE >= :activationdate 
			]]>
		</sql-query>
			
			
	</class>		
</hibernate-mapping>




