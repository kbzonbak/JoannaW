<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- 
	Mapping file autogenerated by MyEclipse Persistence Tools
-->
<hibernate-mapping>
	<class name="bbr.b2b.logistic.customer.entities.Order" table="ORDER"
		entity-name="bbr.b2b.logistic.customer.entities.Order" schema="LOGISTICA" >
		<id name="id" type="java.lang.Long">
			<column name="ID" />
			<generator class="identity">
				<param name="sequence">ORDER_SEQUENCE</param>
				<param name="parameters">AS BIGINT CACHE 100</param>
			</generator>
		</id>
		<property name="created" type="java.util.Date" />
		<property name="number" type="java.lang.Long" />
		<property name="ticket" type="java.lang.String" />
		<property name="receiptnumber" type="java.lang.String" />
		<property name="request" type="java.lang.String" />
		<property name="status" type="java.lang.String" />
		<property name="numref1" type="java.lang.String" />
		<property name="numref2" type="java.lang.String" />
		<property name="numref3" type="java.lang.String" />
		<property name="total" type="java.lang.Double" />
		<property name="issue_date" type="java.util.Date" />
		<property name="effectiv_date" type="java.util.Date" />
		<property name="expiration_date" type="java.util.Date" />
		<property name="commitment_date" type="java.util.Date" />
		<property name="payment_condition" type="java.lang.String" />
		<property name="observation" type="java.lang.String" />
		<property name="responsible" type="java.lang.String" />
		<property name="responsible_email" type="java.lang.String" />
		<property name="valid" type="java.lang.Boolean" />
		<property name="complete" type="java.lang.Boolean" />
		<property name="currency" type="java.lang.String" />
		<many-to-one name="buyer" class="bbr.b2b.logistic.customer.entities.Buyer" column="BUYER_ID" not-null="true" />
		<many-to-one name="vendor" class="bbr.b2b.logistic.customer.entities.Vendor" column="VENDOR_ID" not-null="true" />
		<many-to-one name="ordertype" class="bbr.b2b.logistic.customer.entities.OrderType" column="ORDERTYPE_ID" not-null="true" />
		<many-to-one name="action" class="bbr.b2b.logistic.customer.entities.Action" column="ACTION_ID" not-null="true" />
		<many-to-one name="soastatetype" class="bbr.b2b.logistic.customer.entities.SoaStateType" column="SOASTATETYPE_ID" not-null="true" />
		<many-to-one name="orderstatetype" class="bbr.b2b.logistic.customer.entities.OrderStateType" column="ORDERSTATETYPE_ID" not-null="true" />
		<many-to-one name="deliveryplace" class="bbr.b2b.logistic.customer.entities.Location" column="DELIVERY_PLACE_ID" />
		<many-to-one name="saleplace" class="bbr.b2b.logistic.customer.entities.Location" column="SALE_PLACE_ID" />
		<many-to-one name="client" class="bbr.b2b.logistic.customer.entities.Client" column="CLIENT_ID" />		
		<many-to-one name="section" class="bbr.b2b.logistic.customer.entities.Section" column="SECTION_ID" not-null="true" />		
	</class>
	
	<sql-query name="getPendingSOAOrdersByVendor">
		<![CDATA[
			SELECT
				OC.NUMBER AS ORDERNUMBER,
				OC.issue_date as emitted,
				V.RUT AS VENDOR,
				SST.CODE AS CURRENTSOASTATE,
				SS.when1 as	CURRENTSOASTATETYPEDATE,
				ost."name" as CURRENTSTATETYPE,
				ot."name" as ORDERTYPE
			FROM
				LOGISTICA."order" AS OC JOIN
				LOGISTICA.VENDOR AS V ON (OC.VENDOR_ID = V.ID) 
				join LOGISTICA.SOASTATETYPE AS SST ON SST.ID = OC.soastatetype_id 
				left join logistica.soastate SS on oc.id = ss.order_id and ss.soastatetype_id = oc.soastatetype_id 
				left join logistica.orderstatetype ost on oc.orderstatetype_id = ost.id
				left join logistica.ordertype ot on ot.id = oc.ordertype_id
			WHERE 
				SST.ID <> :soastatetype AND
				ss.when1 <= :soapendingtime AND
				V.ID = :vendorid 
				and OC.issue_date >= :activationdate
		]]>
	</sql-query>	
	
</hibernate-mapping>