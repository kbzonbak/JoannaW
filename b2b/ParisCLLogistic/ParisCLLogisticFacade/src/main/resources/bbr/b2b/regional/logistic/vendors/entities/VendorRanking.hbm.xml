<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- 
	Mapping file autogenerated by MyEclipse Persistence Tools
-->
<hibernate-mapping>
	<class name="bbr.b2b.regional.logistic.vendors.entities.VendorRanking" table="VENDORRANKING" 
		entity-name="bbr.b2b.regional.logistic.vendors.entities.VendorRanking" schema="LOGISTICA" > 
		<composite-id name="id" class="bbr.b2b.regional.logistic.vendors.entities.VendorRankingId">
			<key-property name="vendorid" access="field" type="java.lang.Long" column="VENDOR_ID" />
			<key-property name="rankingid" access="field" type="java.lang.Long" column="RANKING_ID" />
		</composite-id>

		<property name="totalreceivedunits" type="java.lang.Double"></property>
		<property name="totalavailableunits" type="java.lang.Double"></property>
		<property name="sumscoreweighed" type="java.lang.Double"></property>
        <property name="rejectedcount" type="java.lang.Integer"></property>
        <property name="nonassistancecount" type="java.lang.Integer"></property>
        <property name="approvedcount" type="java.lang.Integer"></property>
        
		<many-to-one name="vendor" 
			class="bbr.b2b.regional.logistic.vendors.entities.Vendor" column="VENDOR_ID" 
			not-null="true" insert="false" update="false" />
		<many-to-one name="ranking" 
			class="bbr.b2b.regional.logistic.vendors.entities.Ranking" column="RANKING_ID" 
			not-null="true" insert="false" update="false" />
		
		<sql-query name="getVendorRankingsByRankingId">
			<![CDATA[	
				WITH RK AS(
					SELECT
						VR.VENDOR_ID,
						VR.RANKING_ID,
						(IF (VR.TOTALRECEIVEDUNITS > 0) (VR.SUMSCOREWEIGHED / VR.TOTALRECEIVEDUNITS) ELSE 0) AS RANKING
					FROM
						LOGISTICA.VENDORRANKING AS VR)
				SELECT
					VD.ID AS VENDORID,
					VD.RUT AS VENDORRUT,
					VD.NAME AS VENDORNAME,
					VR.APPROVEDCOUNT,
					VR.NONASSISTANCECOUNT,
					VR.REJECTEDCOUNT,
					VR.RANKING_ID AS RANKINGID,
					RK.RANKING,
					VC.NAME AS VENDORCLASSIFICATION
				FROM
					LOGISTICA.VENDORRANKING AS VR JOIN
					LOGISTICA.VENDOR AS VD ON VD.ID = VR.VENDOR_ID JOIN
					RK ON RK.VENDOR_ID = VR.VENDOR_ID AND RK.RANKING_ID = VR.RANKING_ID JOIN
					LOGISTICA.VENDORCLASSIFICATION AS VC ON RK.RANKING >= VC.MIN AND RK.RANKING <= VC.MAX
				WHERE VR.RANKING_ID = rankingid
			]]>
		</sql-query>	
		
		<sql-query name="getOrderDeliveryEvaluationReportByVendorRanking">
			<![CDATA[	
				SELECT
					ODE.DELIVERY AS DELIVERYNUMBER,
					ET.NAME AS EVALUATIONTYPE,
					ODE.ORDER1 AS ORDERNUMBER,
					LOGISTICA.TOSTR(ODE.DATINGDATE),
					date_part('MONTH', ODE.DATINGDATE) AS DATINGMONTH,
					ODE.TOTALAVAILABLEUNITS,
					ODE.TOTALRECEIVEDUNITS,
					ODE.DELIVERYSCORE,
					ODE.LEVELSERVICEPERCENT,
					ODE.QUALITYPERCENT
				FROM
					LOGISTICA.OCDELEVALUATION ODE
					JOIN LOGISTICA.EVALUATIONTYPE ET ON ET.ID = ODE.EVALUATIONTYPE_ID
					INNER JOIN LOGISTICA.VENDORRANKING VR ON (VR.RANKING_ID = ODE.RANKING_ID AND VR.VENDOR_ID = ODE.VENDOR_ID) 
				WHERE ODE.RANKING_ID = rankingid AND ODE.VENDOR_ID = vendorid
			]]>
		</sql-query>			
	</class>
</hibernate-mapping>
