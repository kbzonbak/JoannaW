<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- 
	Mapping file autogenerated by MyEclipse Persistence Tools
-->
<hibernate-mapping>
	<class name="bbr.b2b.regional.logistic.couriers.entities.ChilexpressCourierStateTmp" table="CHILEXPRESSCOURIERSTATETMP" 
		entity-name="bbr.b2b.regional.logistic.couriers.entities.ChilexpressCourierStateTmp" schema="LOGISTICA">
		<id name="id" type="java.lang.Long">
			<column name="ID" />
			<generator class="identity">
				<param name="sequence">CHILEXPRESSCOURIERSTATETMP_SEQUENCE</param>
				<param name="parameters">AS BIGINT CACHE 100</param>
			</generator>
		</id>
		
		<property name="filename" type="java.lang.String"/>
		<property name="filedate" type="timestamp"/>
		<property name="when" type="timestamp" column="WHEN1"/>
		<property name="line" type="java.lang.Integer"/>
		<property name="workordernumber" type="java.lang.String"/>
		<property name="workorderreference" type="java.lang.String"/>
		<property name="eventcode" type="java.lang.String"/>
		<property name="event" type="java.lang.String"/>
		<property name="eventdate" type="java.lang.String"/>
		<property name="eventtime" type="java.lang.String"/>
		<property name="eventfulldate" type="timestamp"/>
				
		<many-to-one name="directorder"
			class="bbr.b2b.regional.logistic.directorders.entities.DirectOrder" column="DIRECTORDER_ID"/>
			
		<many-to-one name="dodelivery"
			class="bbr.b2b.regional.logistic.deliveries.entities.DODelivery" column="DODELIVERY_ID"/>
			
		<many-to-one name="couriertag"
			class="bbr.b2b.regional.logistic.couriers.entities.CourierTag" column="COURIERTAG_ID"/>
			
		<sql-query name="getFirstFileOutdatedChilexpressCourierStates">
			<![CDATA[
				WITH fn AS(
						SELECT DISTINCT
							filename, filedate
						FROM
							logistica.chilexpresscourierstatetmp
						ORDER BY filedate ASC
						LIMIT 1)
				SELECT
					ccst.id, ccst.filename, ccst.filedate, ccst.when1 AS when, ccst.line, ccst.workordernumber, ccst.workorderreference,
					ccst.eventcode, ccst.event, ccst.eventdate, ccst.eventtime, ccst.eventfulldate, ccst.directorder_id AS directorderid,
					ccst.dodelivery_id AS dodeliveryid, ccst.couriertag_id AS couriertagid
				FROM
					logistica.chilexpresscourierstatetmp AS ccst JOIN
					fn ON fn.filename = ccst.filename
				WHERE
					directorder_id IS NULL
				LIMIT :max
			]]>
		</sql-query>
		
		<sql-query name="getFirstFileUpdatedChilexpressCourierStates">
			<![CDATA[
				WITH fn AS(
						SELECT DISTINCT
							filename, filedate
						FROM
							logistica.chilexpresscourierstatetmp
						ORDER BY filedate ASC
						LIMIT 1),
				d AS(
					SELECT DISTINCT
						ccst.dodelivery_id
					FROM
						logistica.chilexpresscourierstatetmp AS ccst JOIN
						fn ON fn.filename = ccst.filename
					ORDER BY ccst.dodelivery_id ASC
					LIMIT :max)
				SELECT
					ccst.id, ccst.filename, ccst.filedate, ccst.when1 AS when, ccst.line, ccst.workordernumber, ccst.workorderreference,
					ccst.eventcode, ccst.event, ccst.eventdate, ccst.eventtime, ccst.eventfulldate, ccst.directorder_id AS directorderid,
					ccst.dodelivery_id AS dodeliveryid, ccst.couriertag_id AS couriertagid
				FROM
					logistica.chilexpresscourierstatetmp AS ccst JOIN
					fn ON fn.filename = ccst.filename JOIN
					d ON d.dodelivery_id = ccst.dodelivery_id
				ORDER BY ccst.line
			]]>
		</sql-query>
		
		<sql-query name="getChilexpressCourierStatesByFile">
			<![CDATA[	
				SELECT
					id, filename, filedate, when1 AS when, line, workordernumber, workorderreference, eventcode, event, eventdate, eventtime,
					eventfulldate, directorder_id AS directorderid, dodelivery_id AS dodeliveryid, couriertag_id AS couriertagid
				FROM
					logistica.chilexpresscourierstatetmp
				WHERE
					filename = :filename
			]]>
		</sql-query>
		
		<sql-query name="deleteByIds">
			<![CDATA[	
				DELETE
				FROM
					logistica.chilexpresscourierstatetmp
				WHERE
					id IN (:chilexpresscourierstatetmpids)
			]]>
		</sql-query>
											
	</class>
</hibernate-mapping>