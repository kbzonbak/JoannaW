<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- 
	Mapping file autogenerated by MyEclipse Persistence Tools
-->
<hibernate-mapping>
	<class name="bbr.b2b.regional.logistic.fillrate.entities.FillRate" table="FILLRATE"
		entity-name="bbr.b2b.regional.logistic.fillrate.entities.FillRate" schema="LOGISTICA" >
		<id name="id" type="java.lang.Long">
			<column name="ID" />
			<generator class="identity">
				<param name="sequence">FILLRATE_SEQUENCE</param>
				<param name="parameters">AS BIGINT CACHE 100</param>
			</generator>
		</id>

		<property name="totalunits" type="java.lang.Double" not-null="true"></property>
		<property name="receivedunits" type="java.lang.Double" not-null="true"></property>
		<property name="totalneed" type="java.lang.Double"></property>
		<property name="totalreceived" type="java.lang.Double" not-null="true"></property>
		<property name="countorders" type="java.lang.Integer"></property>
						
		<many-to-one name="vendor"
			class="bbr.b2b.regional.logistic.vendors.entities.Vendor" column="VENDOR_ID"
			not-null="true" />	
		<many-to-one name="department"
			class="bbr.b2b.regional.logistic.vendors.entities.Department" column="DEPARTMENT_ID"
			not-null="true" />	
		<many-to-one name="fillrateperiod"
			class="bbr.b2b.regional.logistic.fillrate.entities.FillRatePeriod" column="FILLRATEPERIOD_ID"
			not-null="true" />	
		
		<sql-query name="getFillRatesReportByFillRatePeriod">
			<![CDATA[	
				SELECT
					VD.ID AS VENDORID,
					VD.RUT AS VENDORRUT,
					VD.NAME AS VENDORNAME,
					DP.ID AS DEPARTMENTID,
					DP.NAME AS DEPARTMENTNAME,
					FR.TOTALNEED AS NEEDEDAMOUNT,
					FR.TOTALRECEIVED AS RECEIVEDAMOUNT,
					FR.TOTALUNITS AS NEEDEDUNITS,
					FR.RECEIVEDUNITS AS RECEIVEDUNITS,
					FR.ID AS FILLRATEID,
					((FR.TOTALRECEIVED / FR.TOTALNEED) * 100) AS AMOUNTFILLRATE,
					((FR.RECEIVEDUNITS / FR.TOTALUNITS) * 100) AS UNITSFILLRATE
				FROM
					LOGISTICA.FILLRATE FR JOIN
					LOGISTICA.VENDOR VD ON VD.ID = FR.VENDOR_ID JOIN
					LOGISTICA.DEPARTMENT DP ON DP.ID = FR.DEPARTMENT_ID
				WHERE FR.FILLRATEPERIOD_ID = :fillrateperiodid
			]]>
		</sql-query>

		<sql-query name="getFillRatesReportByVendorAndDepartmentAndLatestPeriods">
			<![CDATA[	
				SELECT
					date_part('YEAR', FRP.SINCE) AS YEAR,
					date_part('MONTH', FRP.SINCE) AS MONTH,
					FR.TOTALNEED AS NEEDEDAMOUNT,
					FR.TOTALRECEIVED AS RECEIVEDAMOUNT,
					FR.TOTALUNITS AS NEEDEDUNITS,
					FR.RECEIVEDUNITS AS RECEIVEDUNITS,
					((FR.TOTALRECEIVED / FR.TOTALNEED) * 100) AS AMOUNTFILLRATE,
					((FR.RECEIVEDUNITS / FR.TOTALUNITS) * 100) AS UNITSFILLRATE
				FROM
					LOGISTICA.FILLRATE FR JOIN
					LOGISTICA.FILLRATEPERIOD FRP ON FRP.ID = FR.FILLRATEPERIOD_ID
				WHERE FR.VENDOR_ID = :vendorid AND FR.DEPARTMENT_ID = :departmentid AND
						FR.FILLRATEPERIOD_ID IN (SELECT FRP.ID
													FROM
														LOGISTICA.FILLRATEPERIOD FRP
													ORDER BY FRP.ID DESC FETCH FIRST (latestperiods) ROWS ONLY)
			]]>
		</sql-query>
					
	</class>		
</hibernate-mapping>




