<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- 
	Mapping file autogenerated by MyEclipse Persistence Tools
-->
<hibernate-mapping>
	<class name="bbr.b2b.regional.logistic.directorders.entities.DirectOrder" table="DIRECTORDER"
		entity-name="bbr.b2b.regional.logistic.directorders.entities.DirectOrder" schema="LOGISTICA" >
		<id name="id" type="java.lang.Long">
			<column name="ID" />
			<generator class="identity">
				<param name="sequence">DIRECTORDER_SEQUENCE</param>
				<param name="parameters">AS BIGINT CACHE 100</param>
			</generator>
		</id>

		<property name="number" type="java.lang.Long" not-null="true"></property>		
		<property name="distributionordernumber" type="java.lang.String"></property>
		<property name="requestnumber" type="java.lang.String" not-null="true"></property>
		<property name="active" type="java.lang.Boolean"></property>
		<property name="emitted" type="timestamp" not-null="true"></property>
		<property name="valid" type="timestamp" not-null="true"></property>
		<property name="expiration" type="timestamp" not-null="true"></property>
		<property name="currentdeliverydate" type="timestamp"></property>
		<property name="originaldeliverydate" type="timestamp"></property>
		<property name="currentstatetypedate" type="timestamp"></property>
		<property name="currentstatetypecomment" type="java.lang.String"></property>
		<property name="currentstatetypewho" type="java.lang.String"></property>
		<property name="paymentdate" type="timestamp"></property>
		<property name="paymenttype" type="java.lang.String"></property>
		<property name="season" type="java.lang.String"></property>
		<property name="clientaddress" type="java.lang.String"></property>
		<property name="clientcity" type="java.lang.String"></property>
		<property name="clientcommune" type="java.lang.String"></property>
		<property name="clientdeptnumber" type="java.lang.String"></property>
		<property name="clienthousenumber" type="java.lang.String"></property>
		<property name="clientphone" type="java.lang.String"></property>
		<property name="clientregion" type="java.lang.String"></property>
		<property name="clientroadnumber" type="java.lang.String"></property>
		<property name="needunits" type="java.lang.Double"></property>
		<property name="pendingunits" type="java.lang.Double" not-null="true"></property>
		<property name="receivedunits" type="java.lang.Double" not-null="true"></property>
		<property name="todeliveryunits" type="java.lang.Double" not-null="true"></property>
		<property name="totalpending" type="java.lang.Double" not-null="true"></property>
        <property name="totalreceived" type="java.lang.Double" not-null="true"></property>
        <property name="totaltodelivery" type="java.lang.Double" not-null="true"></property>
		<property name="totalneed" type="java.lang.Double"></property>
		<property name="comment" type="java.lang.String"></property>
		<property name="currentsoastatetypedate" type="timestamp" column="CURRENTSOASTATETYPEDATE" />
		<property name="courierreceived" type="java.lang.Boolean" not-null="true"></property>
				
		<many-to-one name="client"
			class="bbr.b2b.regional.logistic.buyorders.entities.Client" column="CLIENT_ID"
			not-null="true" />		
		<many-to-one name="vendor"
			class="bbr.b2b.regional.logistic.vendors.entities.Vendor" column="VENDOR_ID"
			not-null="true" />	
		<many-to-one name="responsable"
			class="bbr.b2b.regional.logistic.vendors.entities.Responsable" column="RESPONSABLE_ID" 
			not-null="true" />		
		<many-to-one name="currentstatetype"
			class="bbr.b2b.regional.logistic.directorders.entities.DirectOrderStateType" column="CURRENTSTATETYPE_ID"
			not-null="true" />	
		<many-to-one name="department"
			class="bbr.b2b.regional.logistic.vendors.entities.Department" column="DEPARTMENT_ID"
			not-null="true" />	
		<many-to-one name="currentdelivery"
			class="bbr.b2b.regional.logistic.deliveries.entities.DODelivery" column="DODELIVERY_ID"
			not-null="false" />	
		<many-to-one name="currentsoastatetype"
			class="bbr.b2b.regional.logistic.soa.entities.SOAStateType" column="CURRENTSOASTATETYPE_ID"
			not-null="false" />			
		<many-to-one name="salestore"
			class="bbr.b2b.regional.logistic.locations.entities.Location" column="SALESTORE_ID"
			not-null="false" />	
					
		<sql-query name="getDirectOrderReportByVendorAndNumber">
			<![CDATA[	
				SELECT
					DOC.ID, 
					DOC.ACTIVE, 
					DOC.COMMENT, 
					DOC.CURRENTDELIVERYDATE, 
					COALESCE(DOC.DODELIVERY_ID, 0) AS CURRENTDELIVERYID, 
					DOC.CURRENTSTATETYPECOMMENT, 
					DOC.CURRENTSTATETYPEDATE, 
					DOC.CURRENTSTATETYPE_ID AS CURRENTSTATETYPEID, 
					DOC.CURRENTSTATETYPEWHO, 
					DOC.EMITTED, 
					DOC.NEEDUNITS, 
					DOC.NUMBER, 
					DOC.REQUESTNUMBER, 
					DOC.ORIGINALDELIVERYDATE, 
					DOC.PAYMENTDATE, 
					DOC.PAYMENTTYPE, 
					DOC.SEASON, 
					DOC.TOTALNEED, 
					DOC.VENDOR_ID AS VENDORID, 
					DOC.RESPONSABLE_ID AS RESPONSABLEID, 
					CL.ID AS CLIENTID, 
					CL.NAME AS CLIENTNAME, 
					DOC.CLIENTPHONE AS CLIENTPHONE, 
					CL.RUT AS CLIENTRUT, 
					DOC.CLIENTADDRESS AS CLIENTADDRESS, 
					DOC.CLIENTCITY AS CLIENTCITY, 
					DOC.CLIENTCOMMUNE AS CLIENTCOMMUNE, 
					DL.CURRENTSTCOMMENT AS DELIVERYCURRENTSTCOMMENT, 
					DL.CURRENTSTDATE AS DELIVERYCURRENTSTDATE, 
					DL.CURRENTSTWHO AS DELIVERYCURRENTSTWHO, 
					DL.COMMITEDDATE AS DELIVERYCOMMITEDDATE, 
					DL.ORIGINALDATE AS DELIVERYORIGINALDATE, 
					COALESCE(DL.CURRENTSTATETYPE_ID, 0) AS DELIVERYCURRENTSTATETYPEID, 
					DOC.TODELIVERYUNITS AS TODELIVERYUNITS, 
					DOC.RECEIVEDUNITS AS RECEIVEDUNITS, 
					DOC.PENDINGUNITS AS PENDINGUNITS, 
					DOC.TOTALRECEIVED AS TOTALRECEIVED, 
					DOC.TOTALTODELIVERY AS TOTALTODELIVERY, 
					DOC.TOTALPENDING AS TOTALPENDING
				FROM 
					LOGISTICA.DIRECTORDER DOC JOIN					
					LOGISTICA.CLIENT CL ON DOC.CLIENT_ID = CL.ID LEFT JOIN 
					LOGISTICA.DODELIVERY AS DL ON DOC.DODELIVERY_ID = DL.ID
				WHERE
					DOC.VENDOR_ID = :vendorid AND 
					DOC.NUMBER = :ordernumber			
			]]>
		</sql-query>	
		<sql-query name="getCountDirectOrderReportByOrder">
			<![CDATA[	
				SELECT
					COUNT(DOC.ID)
				FROM 
					LOGISTICA.DIRECTORDER AS DOC JOIN 
					LOGISTICA.VENDOR AS VD ON VD.ID = DOC.VENDOR_ID JOIN 
					LOGISTICA.DIRECTORDERDETAIL AS DOD ON DOC.ID = DOD.ORDER_ID								
				WHERE 
				 	DOC.ID IN (:orderids)			
			]]>
		</sql-query>	
		<sql-query name="getExcelVeVPDOrderReportByOrder">
			<![CDATA[
				SELECT
					DOC.NUMBER AS DOCNUMBER,
					DOC.REQUESTNUMBER,
					DP.CODE AS DEPARTMENTCODE,
					DP.NAME AS DEPARTMENTDESC,
					DOST.NAME AS ORDERSTATEDESC,
					CAST('VeV PD' AS VARCHAR) AS ORDERTYPEDESC,					 
					DOC.EMITTED AS EMITTEDDATE,
					DOC.ORIGINALDELIVERYDATE AS VALIDDATE,
					DOC.CURRENTDELIVERYDATE AS REPROGDATE,
					CL.RUT AS CLIENTRUT,
					CL.NAME AS CLIENTNAME,
					DOC.CLIENTPHONE AS CLIENTPHONE,
					DOC.CLIENTCOMMUNE AS CLIENTCOMMUNE,
					DOC.CLIENTADDRESS AS CLIENTADDRESS,
					DOC.CLIENTCITY AS CLIENTCITY,					
					DOC.CLIENTHOUSENUMBER AS CLIENTHOUSENUMBER,
					DOC.CLIENTDEPTNUMBER AS CLIENTDEPTNUMBER,
					DOC.CLIENTROADNUMBER AS CLIENTROADNUMBER,
					DOC.CLIENTREGION AS CLIENTREGION,
					DOC.COMMENT AS OCCOMMENT,
					IT.INTERNALCODE AS ITEMSKU,
					VI.VENDORITEMCODE,
					IT.NAME AS ITEMDESC,
					DOD.UNITS AS TOTALUNITS,
					DOD.TODELIVERYUNITS AS TODELIVERYUNITS, 
					DOD.RECEIVEDUNITS AS RECEIVEDUNITS, 
					DOD.PENDINGUNITS AS PENDINGUNITS, 
					DOD.LISTCOST,
					DLST.NAME AS DELIVERYSTATETYPE,
					LOSS.NAME SALESTORENAME,
					LOSS.CODE SALESTORECODE,
					CT.SENDNUMBER
				FROM
					LOGISTICA.DIRECTORDER DOC JOIN 					
					LOGISTICA.DIRECTORDERDETAIL AS DOD ON DOD.ORDER_ID = DOC.ID JOIN
					LOGISTICA.ITEM AS IT ON IT.ID = DOD.ITEM_ID JOIN
					LOGISTICA.VENDOR AS VD ON VD.ID = DOC.VENDOR_ID JOIN 
					LOGISTICA.VENDORITEM AS VI ON VI.VENDOR_ID = VD.ID AND VI.ITEM_ID = IT.ID JOIN
					LOGISTICA.DEPARTMENT AS DP ON DP.ID = DOC.DEPARTMENT_ID JOIN
					LOGISTICA.DIRECTORDERSTATETYPE AS DOST ON DOST.ID = DOC.CURRENTSTATETYPE_ID JOIN
					LOGISTICA.CLIENT CL ON DOC.CLIENT_ID = CL.ID LEFT JOIN 
					LOGISTICA.DODELIVERY AS DL ON DOC.DODELIVERY_ID = DL.ID LEFT JOIN
					LOGISTICA.DODELIVERYSTATETYPE AS DLST ON DLST.ID = DL.CURRENTSTATETYPE_ID LEFT JOIN 
					LOGISTICA.LOCATION LOSS ON LOSS.ID = DOC.SALESTORE_ID LEFT JOIN 
					LOGISTICA.COURIERTAG AS CT ON CT.DODELIVERY_ID = DL.ID
				WHERE					
					DOC.ID IN (:orderids)
				ORDER BY
					DOC.NUMBER				
			]]>
		</sql-query>	
		
		<sql-query name="getPendingSOAOrdersByVendor">
			<![CDATA[
				SELECT
					DOC.NUMBER AS ORDERNUMBER, DOC.EMITTED, VD.RUT AS VENDOR, SST.CODE AS CURRENTSOASTATE, OST.NAME AS CURRENTSTATETYPE,
					cast('VeV PD' as varchar) AS ORDERTYPE,  DOC.CURRENTSOASTATETYPEDATE
				FROM
					LOGISTICA.DIRECTORDER AS DOC JOIN
					LOGISTICA.VENDOR AS VD ON VD.ID = DOC.VENDOR_ID JOIN
					LOGISTICA.SOASTATETYPE AS SST ON SST.ID = DOC.CURRENTSOASTATETYPE_ID 
					JOIN LOGISTICA.DIRECTORDERSTATETYPE AS OST ON (OST.ID = DOC.CURRENTSTATETYPE_ID) 	
				WHERE 
					SST.ID <> :soastatetype AND
					DOC.CURRENTSOASTATETYPEDATE <= :soapendingtime AND
					VD.ID = :vendorid AND
					DOC.EMITTED >= :activationdate

			]]>
		</sql-query>
		
		<sql-query name="getVeVPDDataByDirectOrderNumber">
			<![CDATA[
				SELECT
					dor.id AS directorderid,
					dor.number AS directordernumber,
					dor.requestnumber AS directorderrequestnumber,
					vd.name AS vendorname,
					dost.id AS directorderstatetypeid,
					dost.name AS directorderstatetype,
					dodl.id AS dodeliveryid,
					dodl.number AS dodeliverynumber,
					dodst.id AS dodeliverystatetypeid,
					dodst.name AS dodeliverystatetype,
					COALESCE(logistica.tostr(dor.originaldeliverydate), '') AS fcm,
					COALESCE(logistica.tostr(dodl.currentstdate), '') AS deliverycurrentdate	
				FROM
					logistica.directorder AS dor JOIN
					logistica.vendor AS vd ON vd.id = dor.vendor_id JOIN
					logistica.directorderstatetype AS dost ON dost.id = dor.currentstatetype_id LEFT JOIN
					logistica.dodelivery AS dodl ON dodl.id = dor.dodelivery_id LEFT JOIN
					logistica.dodeliverystatetype AS dodst ON dodst.id = dodl.currentstatetype_id
				WHERE 
					dor.number = :directordernumber							
			]]>
		</sql-query>
		
		<sql-query name="getDirectOrdersByVendorsAndReleasedDate">
			<![CDATA[
				SELECT DISTINCT
					vd.code AS vendorcode,
					vd.tradename AS vendortradename,
					doc.number AS ordernumber,
					doc.requestnumber AS requestnumber,
					doc.emitted AS emitted,
					doc.originaldeliverydate AS originaldeliverydate,
					'VEV PD' AS vevtype
				FROM
					logistica.directorderstate AS dos JOIN
					logistica.directorder AS doc ON doc.id = dos.order_id JOIN
					logistica.directorderstatetype AS dost ON dost.id = dos.orderstatetype_id JOIN
					logistica.vendor AS vd ON vd.id = doc.vendor_id
				WHERE
					dost.code = 'LIBERADA' AND dos.when1 >= :since AND dos.when1 < :until AND doc.vendor_id IN (:vendorIds)
			]]>
		</sql-query>
		
		<sql-query name="getByDOTaxDocumentTicket">
			<![CDATA[
				SELECT DISTINCT
						doc.id, doc.number, doc.distributionordernumber, doc.requestnumber, doc.active, doc.emitted, doc.valid, doc.expiration,
						doc.currentdeliverydate, doc.originaldeliverydate, doc.currentstatetypedate, doc.currentstatetypecomment,
						doc.currentstatetypewho, doc.paymentdate, doc.paymenttype, doc.season, doc.clientaddress, doc.clientcity,
						doc.clientcommune, doc.clientdeptnumber, doc.clienthousenumber, doc.clientphone, doc.clientregion, doc.clientroadnumber,
						doc.needunits, doc.pendingunits, doc.receivedunits, doc.todeliveryunits, doc.totalpending, doc.totalreceived,
						doc.totaltodelivery, doc.totalneed, doc.comment, doc.client_id AS clientid, doc.vendor_id AS vendorid,
						doc.responsable_id AS responsableid, doc.currentstatetype_id AS currentstatetypeid, doc.department_id AS departmentid,
						doc.dodelivery_id AS dodeliveryid, doc.currentsoastatetype_id AS currentsoastatetypeid, doc.currentsoastatetypedate,
						doc.salestore_id AS salestoreid, doc.courierreceived
				FROM
					logistica.dotaxdocumentticket AS dotdt JOIN
					logistica.dotaxdocument AS dotd ON dotd.dotaxdocumentticket_id = dotdt.id JOIN
					logistica.directorder AS doc ON doc.id = dotd.directorder_id
				WHERE
					dotdt.id = :ticketid
			]]>
		</sql-query>
		
	</class>		
</hibernate-mapping>