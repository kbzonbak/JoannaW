<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- 
	Mapping file autogenerated by MyEclipse Persistence Tools
-->
<hibernate-mapping>
	<class name="bbr.b2b.regional.logistic.buyorders.entities.Order" table="ORDER"
		entity-name="bbr.b2b.regional.logistic.buyorders.entities.Order" schema="LOGISTICA" >
		<id name="id" type="java.lang.Long">
			<column name="ID" />
			<generator class="identity">
				<param name="sequence">ORDER_SEQUENCE</param>
				<param name="parameters">AS BIGINT CACHE 100</param>
			</generator>
		</id>

		<property name="number" type="java.lang.Long" not-null="true"></property>		
		<property name="distributionordernumber" type="java.lang.String"></property>
		<property name="vendorcodeimp" type="java.lang.String"></property>
		<property name="requestnumber" type="java.lang.String"></property>
		<property name="active" type="java.lang.Boolean"></property>
		<property name="emitted" type="timestamp" not-null="true"></property>
		<property name="valid" type="timestamp" not-null="true"></property>
		<property name="expiration" type="timestamp" not-null="true"></property>
		<property name="originaldeliverydate" type="timestamp"></property>
		<property name="currentstatetypedate" type="timestamp" not-null="true"></property>
		<property name="comment" type="java.lang.String"></property>
		<property name="needunits" type="java.lang.Double" not-null="true"></property>
		<property name="pendingunits" type="java.lang.Double" not-null="true"></property>
		<property name="receivedunits" type="java.lang.Double" not-null="true"></property>
		<property name="todeliveryunits" type="java.lang.Double" not-null="true"></property>
		<property name="outreceivedunits" type="java.lang.Double" not-null="true"></property>		
		<property name="totalneed" type="java.lang.Double"></property>
		<property name="totalpending" type="java.lang.Double" not-null="true"></property>
        <property name="totalreceived" type="java.lang.Double" not-null="true"></property>
        <property name="totaltodelivery" type="java.lang.Double" not-null="true"></property>
		<property name="vevcd" type="java.lang.Boolean"></property>
		<property name="currentsoastatetypedate" type="timestamp" column="CURRENTSOASTATETYPEDATE" />	
		<!-- <property name="senttosoa" type="java.lang.Boolean"></property>-->
				
		<many-to-one name="client"
			class="bbr.b2b.regional.logistic.buyorders.entities.Client" column="CLIENT_ID"
			/>		
		<many-to-one name="currentstatetype"
			class="bbr.b2b.regional.logistic.buyorders.entities.OrderStateType" column="CURRENTSTATETYPE_ID"
			not-null="true" />	
		<many-to-one name="responsable"
			class="bbr.b2b.regional.logistic.vendors.entities.Responsable" column="RESPONSABLE_ID" 
			not-null="true" />		
		<many-to-one name="department"
			class="bbr.b2b.regional.logistic.vendors.entities.Department" column="DEPARTMENT_ID"
			not-null="true" />	
		<many-to-one name="deliverylocation"
			class="bbr.b2b.regional.logistic.locations.entities.Location" column="DELIVERYLOCATION_ID"
			not-null="true" />	
		<many-to-one name="vendor"
			class="bbr.b2b.regional.logistic.vendors.entities.Vendor" column="VENDOR_ID"
			not-null="true" />	
		<many-to-one name="ordertype"
			class="bbr.b2b.regional.logistic.buyorders.entities.OrderType" column="ORDERTYPE_ID" 
			not-null="true" />
		<many-to-one name="currentsoastatetype"
			class="bbr.b2b.regional.logistic.soa.entities.SOAStateType" column="CURRENTSOASTATETYPE_ID"
			not-null="false" />			
		<many-to-one name="salestore"
			class="bbr.b2b.regional.logistic.locations.entities.Location" column="SALESTORE_ID"
			not-null="false" />					
		
		<sql-query name="getCountOrderReportByOrder">
			<![CDATA[	
				SELECT
					COUNT(OC.ID)
				FROM 
					LOGISTICA.ORDER AS OC JOIN 
					LOGISTICA.VENDOR AS VD ON VD.ID = OC.VENDOR_ID JOIN 
					LOGISTICA.ORDERDETAIL AS OD ON OC.ID = OD.ORDER_ID JOIN
					LOGISTICA.PREDELIVERYDETAIL AS PD ON PD.ORDER_ID = OD.ORDER_ID AND PD.ITEM_ID = OD.ITEM_ID JOIN
					LOGISTICA.LOCATION AS LO ON PD.LOCATION_ID = LO.ID				
				WHERE 
				 	OC.ID IN (:orderids)			
			]]>
		</sql-query>	
		<sql-query name="getExcelOrderReportByOrder">
			<![CDATA[
				SELECT
					oc.number AS ocnumber,
					CAST('' AS VARCHAR) AS linedesc,
					dp.code AS departmentcode,
					dp.name AS departmentdesc,
					ost.name AS orderstatedesc,
					ot.name AS ordertypedesc,
					l1.code AS deliverylocationcode,
					l1.name AS deliverylocationdesc,
					l2.code AS destinationlocationcode,
					l2.name AS destinationlocationdesc,
					oc.valid AS validdate,
					oc.expiration AS expirationdate,
					oc.emitted AS emitteddate,
					it.internalcode AS itemsku,
					vi.vendoritemcode,
					it.barcode,
					ft.name AS flowtypedesc,
					it.name AS itemdesc,
					it.color,
					it.dimension,
					it.size,
					it.innerpack,
					od.listprice,
					od.finalprice,
					od.listcost,
					ds.value AS discount,
					od.finalcost,
					pdd.units AS totalunits,		
					pdd.pendingunits,
					pdd.receivedunits,
					pdd.todeliveryunits,		
					0 AS maxtolerance,
					0 AS mintolerance,
					it.ean1,
					it.ean2,
					it.ean3,
					oc.comment,					
					r.name as responsablename, 
					r.lastname as responsablelastname, 
					r.email as responsableemail, 
					r.phone as responsablephone, 
					r.position as responsableposition, 
					ds.comment AS discountcomment, 
					un.name AS unit,
					od.visualorder AS visualorder, 
					ds.code AS discountcode,
					oc.id AS orderid,
					it.id AS itemid,
					COALESCE(ia.curve, 0) AS curve,
					atc.id AS atcid,
					COALESCE(atc.code, '') AS atccode,
					ovd.id AS originalvendorid,
					COALESCE(ovd.code, '') AS originalvendorcode,
					COALESCE(ovd.name, '') AS originalvendorname
				FROM 
					logistica.order AS oc JOIN
					logistica.vendor AS vd ON vd.id = oc.vendor_id JOIN
					logistica.ordertype AS ot ON ot.id = oc.ordertype_id JOIN
					logistica.location AS l1 ON l1.id = oc.deliverylocation_id JOIN
					logistica.orderstatetype AS ost ON ost.id = oc.currentstatetype_id JOIN
					logistica.department AS dp ON dp.id = oc.department_id JOIN
					logistica.orderdetail AS od ON od.order_id = oc.id JOIN
					logistica.item AS it ON it.id = od.item_id LEFT JOIN
					logistica.flowtype AS ft ON ft.id = it.flowtype_id LEFT JOIN
					logistica.detaildiscount AS dds ON dds.order_id = od.order_id AND dds.item_id = od.item_id LEFT JOIN
					logistica.discount AS ds ON ds.id = dds.id LEFT JOIN
					logistica.predeliverydetail AS pdd ON pdd.order_id = od.order_id AND pdd.item_id = od.item_id JOIN
					logistica.location AS l2 ON l2.id = pdd.location_id JOIN
					logistica.vendoritem AS vi ON vi.vendor_id = vd.id AND vi.item_id = it.id JOIN	
					logistica.responsable AS r ON r.id = oc.responsable_id JOIN 
					logistica.unit AS un ON un.id = it.unit_id LEFT JOIN
					logistica.item_atc AS ia ON ia.item_id = it.id LEFT JOIN
					logistica.atc AS atc ON atc.id = ia.atc_id LEFT JOIN
					logistica.vendor AS ovd ON ovd.code = oc.vendorcodeimp	
				WHERE
					oc.id IN (:orderids)
				ORDER BY
					oc.number							
			]]>
		</sql-query>
		
		<sql-query name="getExcelVeVCDOrderReportByOrder">
			<![CDATA[
				SELECT
					OC.NUMBER AS OCNUMBER,
					OC.REQUESTNUMBER,
					CL.COMMUNE,
					CAST('' AS VARCHAR) AS LINEDESC,
					DP.CODE AS DEPARTMENTCODE,
					DP.NAME AS DEPARTMENTDESC,
					OST.NAME AS ORDERSTATEDESC,
					OT.NAME AS ORDERTYPEDESC,
					L1.CODE AS DELIVERYLOCATIONCODE,
					L1.NAME AS DELIVERYLOCATIONDESC,
					L2.CODE AS DESTINATIONLOCATIONCODE,
					L2.NAME AS DESTINATIONLOCATIONDESC,
					LOSS.NAME AS SALESTORENAME,
					LOSS.CODE AS SALESTORECODE,
					OC.VALID AS VALIDDATE,
					OC.EXPIRATION AS EXPIRATIONDATE,
					OC.EMITTED AS EMITTEDDATE,
					OC.ORIGINALDELIVERYDATE AS ORIGINALDELIVERYDATE,
					IT.INTERNALCODE AS ITEMSKU,
					VI.VENDORITEMCODE,
					IT.BARCODE,
					FT.NAME AS FLOWTYPEDESC,
					IT.NAME AS ITEMDESC,
					IT.COLOR,
					IT.DIMENSION,
					IT.SIZE,
					IT.INNERPACK,
					OD.LISTPRICE,
					OD.FINALPRICE,
					OD.LISTCOST,
					DS.VALUE AS DISCOUNT,
					OD.FINALCOST,
					PDD.UNITS AS TOTALUNITS,		
					PDD.PENDINGUNITS,		
					PDD.RECEIVEDUNITS,
					PDD.TODELIVERYUNITS,		
					0 AS MAXTOLERANCE,
					0 AS MINTOLERANCE,
					IT.EAN1,
					IT.EAN2,
					IT.EAN3,
					OC.COMMENT					
				FROM 
					LOGISTICA.ORDER AS OC JOIN
					LOGISTICA.VENDOR AS VD ON VD.ID = OC.VENDOR_ID JOIN
					LOGISTICA.ORDERTYPE AS OT ON OT.ID = OC.ORDERTYPE_ID LEFT JOIN
					LOGISTICA.LOCATION AS LOSS ON LOSS.ID = OC.SALESTORE_ID JOIN
					LOGISTICA.LOCATION AS L1 ON L1.ID = OC.DELIVERYLOCATION_ID JOIN
					LOGISTICA.ORDERSTATETYPE AS OST ON OST.ID = OC.CURRENTSTATETYPE_ID JOIN
					LOGISTICA.DEPARTMENT AS DP ON DP.ID = OC.DEPARTMENT_ID JOIN
					LOGISTICA.ORDERDETAIL AS OD ON OD.ORDER_ID = OC.ID JOIN
					LOGISTICA.ITEM AS IT ON IT.ID = OD.ITEM_ID JOIN
					LOGISTICA.FLOWTYPE AS FT ON FT.ID = IT.FLOWTYPE_ID LEFT JOIN
					LOGISTICA.DETAILDISCOUNT AS DDS ON DDS.ORDER_ID = OD.ORDER_ID AND DDS.ITEM_ID = OD.ITEM_ID LEFT JOIN
					LOGISTICA.DISCOUNT AS DS ON DS.ID = DDS.ID JOIN
					LOGISTICA.PREDELIVERYDETAIL AS PDD ON PDD.ORDER_ID = OD.ORDER_ID AND PDD.ITEM_ID = OD.ITEM_ID JOIN
					LOGISTICA.LOCATION AS L2 ON L2.ID = PDD.LOCATION_ID JOIN
					LOGISTICA.VENDORITEM AS VI ON VI.VENDOR_ID = VD.ID AND VI.ITEM_ID = IT.ID JOIN
					LOGISTICA.CLIENT AS CL ON CL.ID = OC.CLIENT_ID 					
				WHERE 
					OC.ID IN (:orderids)
				ORDER BY
					OC.NUMBER							
			]]>
		</sql-query>
		
		<sql-query name="getExcelVeVCDOrderReportByOrderAndSaleStore">
			<![CDATA[
				SELECT
					OC.NUMBER AS OCNUMBER,
					OC.REQUESTNUMBER,
					CL.COMMUNE,
					CAST('' AS VARCHAR) AS LINEDESC,
					DP.CODE AS DEPARTMENTCODE,
					DP.NAME AS DEPARTMENTDESC,
					OST.NAME AS ORDERSTATEDESC,
					OT.NAME AS ORDERTYPEDESC,
					L1.CODE AS DELIVERYLOCATIONCODE,
					L1.NAME AS DELIVERYLOCATIONDESC,
					L2.CODE AS DESTINATIONLOCATIONCODE,
					L2.NAME AS DESTINATIONLOCATIONDESC,
					LOSS.NAME AS SALESTORENAME,
					LOSS.CODE AS SALESTORECODE,
					OC.VALID AS VALIDDATE,
					OC.EXPIRATION AS EXPIRATIONDATE,
					OC.EMITTED AS EMITTEDDATE,
					OC.ORIGINALDELIVERYDATE AS ORIGINALDELIVERYDATE,
					IT.INTERNALCODE AS ITEMSKU,
					VI.VENDORITEMCODE,
					IT.BARCODE,
					FT.NAME AS FLOWTYPEDESC,
					IT.NAME AS ITEMDESC,
					IT.COLOR,
					IT.DIMENSION,
					IT.SIZE,
					IT.INNERPACK,
					OD.LISTPRICE,
					OD.FINALPRICE,
					OD.LISTCOST,
					DS.VALUE AS DISCOUNT,
					OD.FINALCOST,
					PDD.UNITS AS TOTALUNITS,		
					PDD.PENDINGUNITS,		
					PDD.RECEIVEDUNITS,
					PDD.TODELIVERYUNITS,		
					0 AS MAXTOLERANCE,
					0 AS MINTOLERANCE,
					IT.EAN1,
					IT.EAN2,
					IT.EAN3,
					OC.COMMENT					
				FROM 
					LOGISTICA.ORDER AS OC JOIN
					LOGISTICA.VENDOR AS VD ON VD.ID = OC.VENDOR_ID JOIN
					LOGISTICA.ORDERTYPE AS OT ON OT.ID = OC.ORDERTYPE_ID LEFT JOIN
					LOGISTICA.LOCATION AS LOSS ON LOSS.ID = OC.SALESTORE_ID JOIN
					LOGISTICA.LOCATION AS L1 ON L1.ID = OC.DELIVERYLOCATION_ID JOIN
					LOGISTICA.ORDERSTATETYPE AS OST ON OST.ID = OC.CURRENTSTATETYPE_ID JOIN
					LOGISTICA.DEPARTMENT AS DP ON DP.ID = OC.DEPARTMENT_ID JOIN
					LOGISTICA.ORDERDETAIL AS OD ON OD.ORDER_ID = OC.ID JOIN
					LOGISTICA.ITEM AS IT ON IT.ID = OD.ITEM_ID JOIN
					LOGISTICA.FLOWTYPE AS FT ON FT.ID = IT.FLOWTYPE_ID LEFT JOIN
					LOGISTICA.DETAILDISCOUNT AS DDS ON DDS.ORDER_ID = OD.ORDER_ID AND DDS.ITEM_ID = OD.ITEM_ID LEFT JOIN
					LOGISTICA.DISCOUNT AS DS ON DS.ID = DDS.ID JOIN
					LOGISTICA.PREDELIVERYDETAIL AS PDD ON PDD.ORDER_ID = OD.ORDER_ID AND PDD.ITEM_ID = OD.ITEM_ID JOIN
					LOGISTICA.LOCATION AS L2 ON L2.ID = PDD.LOCATION_ID JOIN
					LOGISTICA.VENDORITEM AS VI ON VI.VENDOR_ID = VD.ID AND VI.ITEM_ID = IT.ID JOIN
					LOGISTICA.CLIENT AS CL ON CL.ID = OC.CLIENT_ID 					
				WHERE 
					OC.ID IN (:orderids)
					AND OC.SALESTORE_ID IN (:salestoreid)
				ORDER BY
					OC.NUMBER							
			]]>
		</sql-query>

		<sql-query name="getPendingSOAOrdersByVendor">
			<![CDATA[
				SELECT
					OC.NUMBER AS ORDERNUMBER, OC.EMITTED, V.RUT AS VENDOR, SST.CODE AS CURRENTSOASTATE, OST.NAME AS CURRENTSTATETYPE,
					OT.NAME AS ORDERTYPE,  OC.CURRENTSOASTATETYPEDATE
				FROM
					LOGISTICA.ORDER AS OC JOIN
					LOGISTICA.VENDOR AS V ON (OC.VENDOR_ID = V.ID) JOIN
					LOGISTICA.SOASTATETYPE AS SST ON SST.ID = OC.CURRENTSOASTATETYPE_ID 
					JOIN LOGISTICA.ORDERSTATETYPE AS OST ON (OST.ID = OC.CURRENTSTATETYPE_ID) 
					JOIN LOGISTICA.ORDERTYPE OT ON (OC.ORDERTYPE_ID = OT.ID)
				WHERE 
					SST.ID <> :soastatetype AND
					OC.CURRENTSOASTATETYPEDATE <= :soapendingtime AND
					V.ID = :vendorid AND
					OC.EMITTED >= :activationdate
					AND OC.expiration >= CURRENT_DATE
						
			]]>
		</sql-query>
		
		<sql-query name="getPendingSOAOrdersByVendorWithClientInfo">
			<![CDATA[
				SELECT
					OC.NUMBER AS ORDERNUMBER, OC.EMITTED, V.RUT AS VENDOR, SST.CODE AS CURRENTSOASTATE, OST.NAME AS CURRENTSTATETYPE,
					OT.NAME AS ORDERTYPE,  OC.CURRENTSOASTATETYPEDATE
				FROM
					LOGISTICA.ORDER AS OC JOIN
					LOGISTICA.VENDOR AS V ON (OC.VENDOR_ID = V.ID) JOIN
					LOGISTICA.SOASTATETYPE AS SST ON SST.ID = OC.CURRENTSOASTATETYPE_ID 						
					JOIN LOGISTICA.ORDERSTATETYPE AS OST ON (OST.ID = OC.CURRENTSTATETYPE_ID) 
					JOIN LOGISTICA.ORDERTYPE OT ON (OC.ORDERTYPE_ID = OT.ID)
				WHERE 
					SST.ID <> :soastatetype AND
					OC.CURRENTSOASTATETYPEDATE <= :soapendingtime AND
					V.ID = :vendorid AND
					OC.EMITTED >= :activationdate AND
					OC.CLIENT_ID is not NULL
					AND OC.expiration >= CURRENT_DATE
						
			]]>
		</sql-query>
		
		<sql-query name="getVeVCDDataByOrderNumber">
			<![CDATA[
				SELECT
					OC.ID AS ORDERID,
					OC.NUMBER AS ORDERNUMBER,
					OC.REQUESTNUMBER AS ORDERREQUESTNUMBER,
					VD.NAME AS VENDORNAME,
					OST.ID AS ORDERSTATETYPEID,
					OST.NAME AS ORDERSTATETYPE,
					LOGISTICA.TOSTR(OC.VALID) AS FPI,
					COALESCE(LOGISTICA.TOSTR(OC.ORIGINALDELIVERYDATE), '') AS FCM,
					COALESCE(LOGISTICA.TOSTR(OC.CURRENTSTATETYPEDATE), '') AS DELIVERYCURRENTDATE
				FROM
					LOGISTICA.ORDER AS OC JOIN
					LOGISTICA.VENDOR AS VD ON VD.ID = OC.VENDOR_ID JOIN
					LOGISTICA.ORDERSTATETYPE OST ON OST.ID = OC.CURRENTSTATETYPE_ID 
				WHERE 
					OC.NUMBER = :ordernumber							
			]]>
		</sql-query>
		
		<sql-query name="getOrdersByVendorsAndReleasedDate">
			<![CDATA[
				SELECT DISTINCT
					vd.code AS vendorcode,
					vd.tradename AS vendortradename,
					oc.number AS ordernumber,
					oc.requestnumber AS requestnumber,
					oc.emitted AS emitted,
					oc.originaldeliverydate AS originaldeliverydate,
					'VEV CD' AS vevtype
				FROM
					logistica.orderstate AS os JOIN
					logistica.order AS oc ON oc.id = os.order_id JOIN
					logistica.orderstatetype AS ost ON ost.id = os.orderstatetype_id JOIN
					logistica.vendor AS vd ON vd.id = oc.vendor_id
				WHERE
					ost.code = 'LIBERADA' AND os.when1 >= :since AND os.when1 < :until AND oc.vendor_id IN (:vendorIds)
			]]>
		</sql-query>
		
	</class>		
</hibernate-mapping>




